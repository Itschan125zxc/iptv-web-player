<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV DRM Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.0/shaka-player.compiled.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #channel-list { max-width: 600px; margin: 20px auto; text-align: left; }
        .channel { padding: 10px; border: 1px solid #ccc; margin: 5px; cursor: pointer; }
        .channel:hover { background: #f0f0f0; }
        video { width: 100%; max-width: 800px; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>IPTV DRM Player (MPD + M3U8)</h2>
    <video id="video" controls autoplay></video>
    
    <h3>Channel List</h3>
    <div id="channel-list"></div>

    <script>
        const channels = [
            { 
                name: "TV 5",
                url: "https://qp-pldt-live-grp-02-prod.akamaized.net/out/u/tv5_hd.mpd",
                type: "mpd",
                keys: {"2615129ef2c846a9bbd43a641c7303ef": "07c7f996b1734ea288641a68e1cfdc4d"
            },

            { 
                name: "ONE SPORT PH",
                url: "https://qp-pldt-live-grp-07-prod.akamaized.net/out/u/cg_onesports_hd.mpd",
                type: "mpd",
                keys: { "53c3bf2eba574f639aa21f2d4409ff11": "3de28411cf08a64ea935b9578f6d0edd" }
            },
            { 
                name: "Channel 3 - HLS (M3U8)",
                url: "http://fl2.moveonjoy.com/ACC_NETWORK/index.m3u8",
                type: "m3u8"
            }
        ];

        const video = document.getElementById("video");
        let player = new shaka.Player(video);
        let hlsPlayer;

        function loadChannel(channel) {
            console.log("Loading:", channel.name);

            if (channel.type === "mpd") {
                if (hlsPlayer) {
                    hlsPlayer.destroy();
                    hlsPlayer = null;
                }

                player.configure({
                    drm: { clearKeys: channel.keys }
                });

                player.load(channel.url).then(() => {
                    console.log("Now playing:", channel.name);
                }).catch(error => console.error("Error loading MPD video", error));

            } else if (channel.type === "m3u8") {
                if (player) {
                    player.unload();
                }

                if (Hls.isSupported()) {
                    hlsPlayer = new Hls();
                    hlsPlayer.loadSource(channel.url);
                    hlsPlayer.attachMedia(video);
                    hlsPlayer.on(Hls.Events.MANIFEST_PARSED, function () {
                        video.play();
                    });
                } else if (video.canPlayType("application/vnd.apple.mpegurl")) {
                    video.src = channel.url;
                    video.addEventListener("loadedmetadata", function () {
                        video.play();
                    });
                } else {
                    console.error("HLS is not supported");
                }
            }
        }

        function renderChannels() {
            channels.forEach(channel => {
                const div = document.createElement("div");
                div.className = "channel";
                div.textContent = channel.name;
                div.onclick = () => loadChannel(channel);
                document.getElementById("channel-list").appendChild(div);
            });
        }

        document.addEventListener("DOMContentLoaded", () => {
            renderChannels();
            loadChannel(channels[0]); // Auto-load first channel
        });
    </script>
</body>
</html>
