<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IPTV Web Player</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.6/shaka-player.compiled.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
        }
        video {
            width: 80%;
            max-width: 800px;
            margin: 20px auto;
            display: block;
        }
        select, button {
            padding: 10px;
            margin: 10px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>IPTV Web Player</h1>

    <select id="channelSelect">
        <option value="https://ni.bobay.workers.dev/1216/manifest.mpd" data-key='{"keys":{"31363735313439343038343136333130:386c6b6a64704d4d3039354d4e6a6933":"base64-key-1"}}'>ANC</option>
        <option value="https://ni.bobay.workers.dev/1335/manifest.mpd" data-key='{"keys":{"31363735313439343038343136333130:386c6b6a64704d4d3039354d4e6a6933":"base64-key-2"}}'>Channel 2</option>
    </select>
    
    <button onclick="loadChannel()">Play</button>
    <video id="video" controls autoplay></video>

    <script>
        async function initPlayer() {
            if (!shaka.Player.isBrowserSupported()) {
                alert("Error: Browser not supported!");
                return;
            }
            window.player = new shaka.Player(document.getElementById("video"));
            window.player.addEventListener("error", onErrorEvent);
        }

        function onErrorEvent(event) {
            console.error("Error:", event.detail);
        }

        async function loadChannel() {
            const select = document.getElementById("channelSelect");
            const url = select.value;
            const key = JSON.parse(select.options[select.selectedIndex].getAttribute("data-key"));

            try {
                await window.player.load(url);
                window.player.configure({
                    drm: { clearKeys: key }
                });
                console.log("Stream loaded successfully");
            } catch (error) {
                console.error("Error loading stream", error);
            }
        }

        document.addEventListener("DOMContentLoaded", initPlayer);
    </script>
</body>
</html>
